---
alwaysApply: false
---
Enhance and validate an existing plan provided by the user. The goal is to transform a simple, high-level plan into a comprehensive, production-ready plan with greater detail and edge case awareness. Follow this process:

## 1. Initial Understanding and Clarification
First, understand the user's plan and ask clarifying questions:
- Restate your understanding of the user's plan and its objectives.
- Identify ambiguities or missing information.
- **Ask clarifying questions** about:
  - The specific goals and success criteria
  - Known constraints (time, resources, technical limitations)
  - Target scope (what's in/out of scope)
  - Expected impact and affected systems/users
  - Non-functional requirements (performance, security, etc.)
  - Any specific concerns or risks the user has identified
- **Wait for the user's responses before proceeding.**

## 2. Search and Discovery
Before diving into detailed planning, gather context:
- Search the codebase to understand existing implementations related to the plan.
- Identify relevant files, modules, patterns, and architectures already in use.
- Discover dependencies, integration points, and potential conflicts.
- Look for similar features or functionality to learn from or build upon.
- Note any existing tests, documentation, or infrastructure that will be affected.
- Summarize findings and how they inform the plan.

## 3. Task Breakdown and Componentization
Analyze whether the plan should be broken down:
- Assess if the plan is a single cohesive task or multiple independent components.
- If complex, break it down into smaller, manageable components that could be:
  - Implemented independently
  - Tested in isolation
  - Delivered incrementally
- For each component, identify dependencies and suggested implementation order.
- Propose the breakdown to the user for validation.

## 4. Analyze Strategic Considerations
- Evaluate if the chosen approach is optimal for the stated goals.
- Identify alternative approaches that might be worth considering.
- For each alternative, briefly note pros, cons, and trade-offs compared to the current plan.
- If a significant alternative exists, ask the user if they've considered it and why they chose their approach.

## 5. Enhance with Detail
Expand each step of the plan with:
- More granular sub-steps and implementation specifics.
- Key data structures, modules, functions, classes, infrastructure, or libraries needed.
- Dependencies between steps (what must happen before/after).
- Areas requiring refactoring or infrastructure changes.
- How components will interact at both high and low levels.
- Error handling and rollback strategies.

## 6. Identify Edge Cases and Risks
- Enumerate potential edge cases not covered in the original plan.
- Identify technical risks (performance, scalability, security, compatibility).
- Highlight missing considerations (testing strategy, deployment, monitoring, documentation).
- Consider failure modes and recovery scenarios.
- Flag potential breaking changes or backward compatibility issues.

## 7. Final Validation Questions
Ask the user about considerations they may have overlooked:
- **Scope**: Are there related areas that should be included or explicitly excluded?
- **Impact**: Have they considered downstream effects on other systems/users?
- **Constraints**: Are there technical, time, or resource constraints not mentioned?
- **Requirements**: Are there non-functional requirements (performance, security, compliance)?
- **Migration**: If changing existing functionality, what's the migration path?
- **Testing**: How will success be measured and validated?

## 8. Deliver Enhanced Plan
- Present the enhanced plan with clear sections and actionable steps.
- Highlight areas where you've added significant detail or identified gaps.
- Summarize key risks and edge cases to watch for.
- Provide clear next steps for implementation.
- Wait for user feedback before proceeding to implementation.
